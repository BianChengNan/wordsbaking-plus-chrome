(function(){function i(){var i=t(),r=i.toString().trim();r&&n.show(r,i.getRangeAt(0))}function t(){var n,t;return r.call(window,"getSelection")?(t=window.getSelection,delete window.getSelection,n=window.getSelection(),window.getSelection=t):n=window.getSelection(),n}function u(){function w(){window.open(chrome.extension.getURL("options.html"));b()}function c(){var n=e.getBoundingClientRect();return n.width?(ut(n),!0):t().toString()?(b(),!1):void 0}function rt(n){n.noResult=function(n){return!(this.definitions&&this.definitions.length||this.webDefinitions&&this.webDefinitions.length||this.translation&&this.translation.text&&this.translation.text!=this.query||n&&this.synonyms&&this.synonyms.length)};n.onlyTranslation=function(n){return this.translation&&this.translation.text&&this.translation.text!=this.query&&!(this.definitions&&this.definitions.length||this.webDefinitions&&this.webDefinitions.length||n&&this.synonyms&&this.synonyms.length)}}function ut(n){r.style.cssText="";var e=n.width,b=n.height,o=n.left,l=n.top,i=r.offsetWidth,k=r.offsetHeight,f=self.pageXOffset,s=self.pageYOffset,a=document.body,v=document.documentElement,y=Math.min(a.clientWidth,v.clientWidth),d=Math.min(a.clientHeight,v.clientHeight),u=10,p=12,h=s+l-p-k;r.className="above";h-u<s&&(h=s+l+b+p,r.className="below");var t=o+e/2-i/2,c=i/2,w=20;t-u<f?(t=f+u,c=Math.max(w,o+e/2-t)):t+i+u>f+y&&(t=f+y-i-u,c=Math.min(i-w,o+e/2-t));r.style.cssText="top: "+h+"px!important; left: "+t+"px!important";nt.style.cssText="left: "+c+"px!important"}var l=this,i=$('<div id="wbp-popup"><div id="wbp-loading">'+lang.loading+'...<\/div><div id="wbp-loaded"><div id="wbp-headword-wrapper"><span id="wbp-headword"><\/span><span id="wbp-pos"><\/span><span id="wbp-wordsbook-button"><\/span><\/div><div id="wbp-phonetic-wrapper"><span id="wbp-phonetic"><\/span><span id="wbp-audio"><\/span><\/div><div id="wbp-definitions"><\/div><div id="wbp-translation"><\/div><\/div><div id="wbp-popup-arrow"><div><div><\/div><\/div><\/div><\/div>'),r=i[0],k=i.find("#wbp-loading")[0],d=i.find("#wbp-loaded")[0],nt=i.find("#wbp-popup-arrow")[0],n=i.find("#wbp-headword-wrapper")[0],tt=i.find("#wbp-headword")[0],s=i.find("#wbp-pos")[0],g=i.find("#wbp-phonetic-wrapper")[0],it=i.find("#wbp-phonetic")[0],h=i.find("#wbp-audio")[0],u=i.find("#wbp-wordsbook-button")[0],a=i.find("#wbp-definitions")[0],v=i.find("#wbp-translation")[0],f,e,y,o,p=new function(){var t=[],n=-1;this.add=function(i){t[n]!=i&&(n++,n<t.length&&(t.length=n),t.push(i))};this.previous=function(){return n>0?(n--,t[n]):undefined};this.next=function(){return n<t.length-1?(n++,t[n]):undefined}},b;i.click(function(n){n.stopPropagation()}).contextmenu(function(n){n.stopPropagation()}).dblclick(function(n){var i=t().toString().trim();i&&l.show(i,e);n.stopPropagation()}).delegate(".wbp-word-true","click",function(){l.show($(this).text(),e)});$(h).click(function(){new Audio($(this).attr("data-audio")).play()});$(u).click(function(){var t=o,i=t.headword.text;n.className=="wbp-wb-addable"?(n.className="wbp-wb-adding",n.title="",addToWordsbook(i,function(i,r){if(!i){w();return}t==o&&(n.className=r?"wbp-wb-added":"wbp-wb-addable",n.title=r?lang.removeFromWordsbook:lang.addToWordsbook)})):n.className=="wbp-wb-added"?(n.className="wbp-wb-removing",n.title="",removeFromWordsbook(i,function(i,r){if(!i){w();return}t==o&&(n.className=r?"wbp-wb-addable":"wbp-wb-added",n.title=r?lang.addToWordsbook:lang.removeFromWordsbook)})):n.className=="wbp-wb-setup"&&w()});$(window).resize(function(){f&&c()}).scroll(function(){f&&c()});document.addEventListener("keydown",function(n){if(f){var t;(n.keyCode==189?t=p.previous():n.keyCode==187&&(t=p.next()),t)&&(l.show(t,e),n.stopPropagation())}});this.getCurrentQuery=function(){return f?y:undefined};this.show=function(t,i){function b(n){var t=document.createElement("div");return t.innerText=n,t.innerHTML}function w(n,t){n.style.cssText=t?"display: inline-block!important;":"display: block!important;"}function l(n){n.style.cssText="display: none!important;"}(document.body.appendChild(r),f=!0,e=i,y=t,w(k),l(d),c())&&(p.add(t),fetchResult(t,function(i,r){var p,et,ot,lt,ct,at,f,vt;if(i&&t==y){if(o=r,rt(r),l(k),w(d),!r.headword||r.noResult(!1)||r.onlyTranslation(!1))l(n),l(u),l(a),w(v),v.innerHTML=splitWords(r.translation?r.translation.text:t);else{tt.innerText=r.headword.beautified;w(n);r.wordsbookStatus?(w(u,!0),n.className="wbp-wb-querying",wordsbookExists(r.headword.text,function(t,i){r==o&&(t?(n.className=i?"wbp-wb-added":"wbp-wb-addable",n.title=i?lang.removeFromWordsbook:lang.addToWordsbook):(n.className="wbp-wb-setup",n.title=lang.setupAccount))})):l(u);var ft=r.definitions,nt,e,st=[],ut=[];if(ft.length){if(ft.length==1){for(p=ft[0].poss,et=0,nt=p.length,f=0;f<nt;f++)p[f].meanings.length>et&&(e=p[f],et=e.meanings.length);for(ut.push(splitWords(e.meanings[0],"wbp-word")),f=0;f<nt;f++)p[f]!=e&&st.push(p[f].pos)}else{var ht={},p=ft[0].poss,et=0;for(nt=p.length,f=0;f<nt;f++)ht[p[f].pos]=p[f];for(ot=ft[1].poss,f=0;f<ot.length;f++)ht.hasOwnProperty(ot[f].pos)&&ht[ot[f].pos].meanings.length>et&&(lt=ot[f],e=ht[lt.pos],et=e.meanings.length);for(e?(ut.push(splitWords(e.meanings[0],"wbp-word")),ut.push(splitWords(lt.meanings[0],"wbp-word"))):(e=p[0],ut.push(splitWords(e.meanings[0],"wbp-word"))),f=0;f<nt;f++)p[f]!=e&&st.push(p[f].pos)}s.innerHTML=e.pos+(nt>1?"<span>+"+(nt-1)+"<\/span>":"");st.unshift(e.pos);s.title=st.join(", ");w(s,!0);u.className=""}else l(s),u.className="alone",r.webDefinitions.length&&(ct=r.webDefinitions[0],ut.push(splitWords(ct.text,"wbp-word")),ut.push('<a href="'+b(ct.url)+'" target="_blank">'+b(ct.url)+"<\/a>"));for(at="",f=0;f<ut.length;f++)at+="<div>"+ut[f]+"<\/div>";a.innerHTML=at;l(v);w(a)}r.phonetics&&r.phonetics.length?(it.innerText=r.phonetics[0].text,r.audio.us?(w(h,!0),h.setAttribute("data-audio",r.audio.us),vt=new Audio(r.audio.us),options.autoAudio&&vt.play()):l(h),w(g,!0)):l(g);c()}}))};b=this.hide=function(){r.parentNode&&r.parentNode.removeChild(r);f=!1}}var r=Object.prototype.hasOwnProperty,n;chrome.runtime.onMessage.addListener(function(i,r,u){switch(i.type){case"getSelection":var f=n.getCurrentQuery()||t().toString().trim();f&&u({text:f});n.hide()}});n=new u;$(document).dblclick(function(){options.popupDblClick&&i()}).click(function(){n.hide()}).contextmenu(function(){n.hide()}).mouseup(function(n){options.popupCtrlKey&&n.ctrlKey&&setTimeout(function(){i()},0)})})();
/*
//# sourceMappingURL=content.min.js.map
*/